ðŸ§­ geomapping
=============

This repository provides code to evaluate spatial overlaps between different spatial reporting units, such as Lower Layer Super Output Areas (LSOAs) and wastewater catchment areas.

The software was originally developed to generate case load estimates for wastewater treatment plants during the early stages of the COVID-19 pandemic (see `here <https://docs.google.com/document/d/1QdggnUQUA9TXKEc3J2cBKolgty3mSQbH8ucfxZ5gyI4/edit>`__ for details), but it is more generally applicable. The script uses `R-trees <https://en.wikipedia.org/wiki/R-tree>`__ to evaluate intersections efficiently--even for large datasets.

Installation
------------

Required dependencies can be installed by running

.. code::

   pip install -r requirements.txt

After installing depndencies, an example dataset can be generated by running

.. code::

   make example

and the generated results can be found at :code:`workspace/RiverBasins_LAD20_BGC.json`. The example evaluates intersections between local authority districts (LADs) and river catchment basins.

Interface
---------

The command line utility :code:`geomapping.py` takes two geospatial datasets as input stores intersections between the spatial units in an output file.

.. code::

   usage: geomapping [-h] [--crs CRS] [--crs1 CRS1] [--crs2 CRS2]
                     filename1 filename2 output

   positional arguments:
     filename1    filename of the first set of shapes
     filename2    filename of the second set of shapes
     output       filename for the output

   optional arguments:
     -h, --help   show this help message and exit
     --crs CRS    coordinate reference system in which to evaluate intersections
                  (defaults to the British National Grid epsg:27700
     --crs1 CRS1  coordinate reference system of the first set of shapes
                  (inferred if omitted)
     --crs2 CRS2  coordinate reference system of the second set of shapes
                  (inferred if omitted)

Data
----

Running

.. code::

   make data

will download a number of relevant datasets, such as LSOA and LAD boundaries, from the geoportal of the Office for National Statistics.
